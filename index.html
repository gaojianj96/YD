<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <title>结单票生成器</title>
  <style>
    body {
      font-family: "微软雅黑", Arial, sans-serif;
      background: #f8f6ff;
      color: #333;
    }

    .container {
      max-width: 500px;
      margin: 40px auto;
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 2px 12px #e0e0e0;
      padding: 32px;
    }

    h2 {
      text-align: center;
      margin-bottom: 16px;
    }

    label {
      display: block;
      margin: 12px 0 4px;
    }

    input,
    select {
      width: 100%;
      padding: 6px 8px;
      border-radius: 6px;
      border: 1px solid #ccc;
      margin-bottom: 8px;
    }

    textarea {
      width: 100%;
      height: 220px;
      margin-top: 18px;
      font-size: 1.1em;
      border-radius: 8px;
      border: 1px solid #bbb;
      padding: 10px;
    }

    button {
      width: 100%;
      padding: 10px;
      background: #bfa6e7;
      color: #fff;
      border: none;
      border-radius: 8px;
      font-size: 1.1em;
      cursor: pointer;
      margin-top: 10px;
    }

    button:hover {
      background: #a48ad4;
    }

    .note {
      font-size: 0.95em;
      color: #888;
      margin-bottom: 10px;
    }

    .output-container {
      position: relative;
      margin-top: 18px;
    }

    .copy-btn {
      position: absolute;
      right: 10px;
      top: 10px;
      width: auto;
      margin: 0;
      padding: 4px 12px;
      font-size: 0.9em;
      background: rgba(191, 166, 231, 0.9);
    }

    .copy-btn:hover {
      background: rgba(164, 138, 212, 0.9);
    }
  </style>
</head>

<body>
  <div class="container">
    <h2>结单票生成器</h2>
    <form id="ticketForm" autocomplete="off">
      <label>板 宝</label>
      <input type="text" id="banbao" value="" required>

      <label>陪 宝</label>
      <input type="text" id="peibao" value="" required>

      <label>单 类</label>
      <input type="text" list="danlei-list" id="danlei" autocomplete="off" required>
      <datalist id="danlei-list">
      </datalist>

      <label>单 数</label>
      <input type="number" list="danshu-list" id="danshu" value="1" required>
      <datalist id="danshu-list">
        <option value="1">
        <option value="2">
        <option value="3">
        <option value="4">
        <option value="5">
      </datalist>

      <label>金 额</label>
      <input type="number" id="jine" value="50" required>

      <label>日 期</label>
      <input type="text" id="riqi" required>

      <label>场 控</label>
      <input type="text" list="changkong-list" id="changkong" value="软肋" required onfocus="this.removeAttribute('readonly');this.value='';document.getElementById('changkong-list').style.display='block';" onblur="setTimeout(()=>{document.getElementById('changkong-list').style.display='none';},200)">
      <datalist id="changkong-list"></datalist>

      <label>扣卡状态</label>
      <select id="kouka">
        <option value="否">否</option>
        <option value="是">是</option>
      </select>

      <button type="button" onclick="generateTicket()">生成结单票</button>
    </form>
    <div class="output-container">
      <textarea id="output" readonly></textarea>
      <button class="copy-btn" onclick="copyTicket()">复制</button>
    </div>
    <div class="note">可编辑金额、日期、场控、扣卡状态</div>
  </div>
  <script>
    // 默认价格映射
    const defaultPriceMap = {
      "陪聊半": 25,
      "文聊半": 15,
      "虚恋半": 35,
      "哄睡半": 18,
      "挂房半": 8.88,
      "头像": 8,
      "叫醒": 9.9,
      "情头": 13.14,
      "照片": 13.14,
      "视频半": 50,
      "酒单漏手": 40,
      "酒单露脸": 99,
      "观影": 52,
      "随机歌单": 12,
      "指定歌单": 15,
      "王者娱乐局": 9.9,
      "王者娱乐半": 9.9,
      "王者技术局": 16,
      "和平娱乐局": 9.9,
      "和平娱乐半": 15,
      "和平技术半": 22,
      "金铲铲半": 15,
      "其它手游半": 20,
      "TT小游戏半": 18,
      "端游半": 25,
      "个冠天": 8.8,
      "个冠周": 28.8,
      "个冠月": 88.8,
      "群冠天": 12,
      "群冠周": 52,
      "群冠月": 138,
      "包夜娱乐": 160,
      "包天娱乐": 220,
      "包夜技术": 210,
      "包天技术": 410,
      "包夜周": 1314,
      "包天周": 2888,
      "包夜月": 6666,
      "包天月": 11888,
      "好友位": 188
    };
    let priceMap = defaultPriceMap;
    // 检查 price-map.json 是否存在
    fetch('price-map.json', { method: 'HEAD' })
      .then(res => {
        if (res.ok) {
          // 存在则加载外部文件
          return fetch('price-map.json').then(r => r.json());
        } else {
          // 不存在则用默认
          return null;
        }
      })
      .then(data => {
        if (data) priceMap = data;
        // 动态生成单类 datalist 选项
        const danleiDatalist = document.getElementById('danlei-list');
        danleiDatalist.innerHTML = '';
        Object.entries(priceMap).forEach(([key, price]) => {
          const opt = document.createElement('option');
          opt.value = key;
          opt.textContent = `${key} (${price}元)`; // 显示价格信息
          danleiDatalist.appendChild(opt);
        });
        // 设置input的值为第一个key
        const danleiInput = document.getElementById('danlei');
        if (!danleiInput.value && Object.keys(priceMap).length > 0) {
          danleiInput.value = Object.keys(priceMap)[0];
        }
        updateJine();
      });

    // 设置当前日期时间
    function pad(n) { return n < 10 ? '0' + n : n; }
    function setCurrentDate() {
      const now = new Date();
      const month = now.getMonth() + 1;
      const day = now.getDate();
      const hour = now.getHours();
      const min = now.getMinutes();
      document.getElementById('riqi').value = `${month}.${day}/${pad(hour)}:${pad(min)}`;
    }
    setCurrentDate();

    // 场控默认值
    function setChangkongDefault() {
      // 检查 constants.json 是否存在
      fetch('constants.json', { method: 'HEAD' })
        .then(res => {
          if (res.ok) {
            // 存在则加载
            return fetch('constants.json').then(r => r.json());
          } else {
            // 不存在则用默认
            return null;
          }
        })
        .then(data => {
          const changkongList = document.getElementById('changkong-list');
          changkongList.innerHTML = '';
          let changkongArr = ['软肋', '小柔'];
          if (data && Array.isArray(data.changkong) && data.changkong.length > 0) {
            changkongArr = data.changkong;
          }
          changkongArr.forEach(name => {
            const opt = document.createElement('option');
            opt.value = name;
            changkongList.appendChild(opt);
          });
          document.getElementById('changkong').value = changkongArr[0];
        });
    }
    setChangkongDefault();

    // 自动计算金额
    function updateJine() {
      const danlei = document.getElementById('danlei').value;
      const danshu = parseInt(document.getElementById('danshu').value, 10);
      const price = priceMap[danlei];
      if (typeof price === 'number' && !isNaN(danshu)) {
        document.getElementById('jine').value = price * danshu;
      } else {
        document.getElementById('jine').value = '';
      }
    }
    document.getElementById('danlei').addEventListener('input', updateJine);
    document.getElementById('danshu').addEventListener('input', updateJine);

    // 生成票据
    function generateTicket() {
      const banbao = document.getElementById('banbao').value.trim();
      const peibao = document.getElementById('peibao').value.trim();
      const danlei = document.getElementById('danlei').value;
      const danshu = document.getElementById('danshu').value;
      const jine = document.getElementById('jine').value;
      const riqi = document.getElementById('riqi').value.trim();
      const changkong = document.getElementById('changkong').value.trim();
      const kouka = document.getElementById('kouka').value.trim();

      const ticket = `♛･:.｡.☾ 𝓕𝓪𝓲𝓻𝔂 𝓣𝓪𝓵𝓮 ☽.｡.:･♛
✧･ﾟ: ✧･ﾟ: 结 单 票 :ﾟ･✧:ﾟ･✧
⋆｡˚ꕥ 板 宝：  ${banbao}
⋆｡˚ꕥ 陪 宝：${peibao}
⋆｡˚ꕥ 单 类：${danlei}
⋆｡˚ꕥ 单 数：${danshu}
⋆｡˚ꕥ 金 额：${jine}
⋆｡˚ꕥ 日 期：${riqi}
⋆｡˚ꕥ 场 控：${changkong}
⋆｡˚ꕥ 扣卡状态：${kouka}
✧･ﾟ: ✧･ﾟ: 星月童话 :ﾟ･✧:ﾟ･✧`;

      document.getElementById('output').value = ticket;
    }

    // 复制票据
    function copyTicket() {
      const output = document.getElementById('output');
      output.select();
      document.execCommand('copy');
      const btn = document.querySelector('.copy-btn');
      btn.textContent = '已复制';
      setTimeout(() => {
        btn.textContent = '复制';
      }, 2000);
    }
  </script>
</body>

</html>