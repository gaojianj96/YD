<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <title>ç»“å•ç¥¨ç”Ÿæˆå™¨</title>
  <style>
    body {
      font-family: "å¾®è½¯é›…é»‘", Arial, sans-serif;
      background: #f8f6ff;
      color: #333;
    }

    .container {
      max-width: 500px;
      margin: 40px auto;
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 2px 12px #e0e0e0;
      padding: 32px;
    }

    h2 {
      text-align: center;
      margin-bottom: 16px;
    }

    label {
      display: block;
      margin: 12px 0 4px;
    }

    input,
    select {
      width: 100%;
      padding: 6px 8px;
      border-radius: 6px;
      border: 1px solid #ccc;
      margin-bottom: 8px;
    }

    textarea {
      width: 100%;
      height: 220px;
      margin-top: 18px;
      font-size: 1.1em;
      border-radius: 8px;
      border: 1px solid #bbb;
      padding: 10px;
    }

    button {
      width: 100%;
      padding: 10px;
      background: #bfa6e7;
      color: #fff;
      border: none;
      border-radius: 8px;
      font-size: 1.1em;
      cursor: pointer;
      margin-top: 10px;
    }

    button:hover {
      background: #a48ad4;
    }

    .note {
      font-size: 0.95em;
      color: #888;
      margin-bottom: 10px;
    }

    .output-container {
      position: relative;
      margin-top: 18px;
    }

    .copy-btn {
      position: absolute;
      right: 10px;
      top: 10px;
      width: auto;
      margin: 0;
      padding: 4px 12px;
      font-size: 0.9em;
      background: rgba(191, 166, 231, 0.9);
    }

    .copy-btn:hover {
      background: rgba(164, 138, 212, 0.9);
    }
  </style>
</head>

<body>
  <div class="container">
    <h2>ç»“å•ç¥¨ç”Ÿæˆå™¨</h2>
    <form id="ticketForm" autocomplete="off">
      <label>æ¿ å®</label>
      <input type="text" id="banbao" value="" required>

      <label>é™ª å®</label>
      <input type="text" id="peibao" value="" required>

      <label>å• ç±»</label>
      <input type="text" list="danlei-list" id="danlei" autocomplete="off" required>
      <datalist id="danlei-list">
      </datalist>

      <label>å• æ•°</label>
      <input type="number" list="danshu-list" id="danshu" value="1" required>
      <datalist id="danshu-list">
        <option value="1">
        <option value="2">
        <option value="3">
        <option value="4">
        <option value="5">
      </datalist>

      <label>é‡‘ é¢</label>
      <input type="number" id="jine" value="50" required>

      <label>æ—¥ æœŸ</label>
      <input type="text" id="riqi" required>

      <label>åœº æ§</label>
      <input type="text" list="changkong-list" id="changkong" value="è½¯è‚‹" required onfocus="this.removeAttribute('readonly');this.value='';document.getElementById('changkong-list').style.display='block';" onblur="setTimeout(()=>{document.getElementById('changkong-list').style.display='none';},200)">
      <datalist id="changkong-list"></datalist>

      <label>æ‰£å¡çŠ¶æ€</label>
      <select id="kouka">
        <option value="å¦">å¦</option>
        <option value="æ˜¯">æ˜¯</option>
      </select>

      <button type="button" onclick="generateTicket()">ç”Ÿæˆç»“å•ç¥¨</button>
    </form>
    <div class="output-container">
      <textarea id="output" readonly></textarea>
      <button class="copy-btn" onclick="copyTicket()">å¤åˆ¶</button>
    </div>
    <div class="note">å¯ç¼–è¾‘é‡‘é¢ã€æ—¥æœŸã€åœºæ§ã€æ‰£å¡çŠ¶æ€</div>
  </div>
  <script>
    // é»˜è®¤ä»·æ ¼æ˜ å°„
    const defaultPriceMap = {
      "é™ªèŠåŠ": 25,
      "æ–‡èŠåŠ": 15,
      "è™šæ‹åŠ": 35,
      "å“„ç¡åŠ": 18,
      "æŒ‚æˆ¿åŠ": 8.88,
      "å¤´åƒ": 8,
      "å«é†’": 9.9,
      "æƒ…å¤´": 13.14,
      "ç…§ç‰‡": 13.14,
      "è§†é¢‘åŠ": 50,
      "é…’å•æ¼æ‰‹": 40,
      "é…’å•éœ²è„¸": 99,
      "è§‚å½±": 52,
      "éšæœºæ­Œå•": 12,
      "æŒ‡å®šæ­Œå•": 15,
      "ç‹è€…å¨±ä¹å±€": 9.9,
      "ç‹è€…å¨±ä¹åŠ": 9.9,
      "ç‹è€…æŠ€æœ¯å±€": 16,
      "å’Œå¹³å¨±ä¹å±€": 9.9,
      "å’Œå¹³å¨±ä¹åŠ": 15,
      "å’Œå¹³æŠ€æœ¯åŠ": 22,
      "é‡‘é“²é“²åŠ": 15,
      "å…¶å®ƒæ‰‹æ¸¸åŠ": 20,
      "TTå°æ¸¸æˆåŠ": 18,
      "ç«¯æ¸¸åŠ": 25,
      "ä¸ªå† å¤©": 8.8,
      "ä¸ªå† å‘¨": 28.8,
      "ä¸ªå† æœˆ": 88.8,
      "ç¾¤å† å¤©": 12,
      "ç¾¤å† å‘¨": 52,
      "ç¾¤å† æœˆ": 138,
      "åŒ…å¤œå¨±ä¹": 160,
      "åŒ…å¤©å¨±ä¹": 220,
      "åŒ…å¤œæŠ€æœ¯": 210,
      "åŒ…å¤©æŠ€æœ¯": 410,
      "åŒ…å¤œå‘¨": 1314,
      "åŒ…å¤©å‘¨": 2888,
      "åŒ…å¤œæœˆ": 6666,
      "åŒ…å¤©æœˆ": 11888,
      "å¥½å‹ä½": 188
    };
    let priceMap = defaultPriceMap;
    // æ£€æŸ¥ price-map.json æ˜¯å¦å­˜åœ¨
    fetch('price-map.json', { method: 'HEAD' })
      .then(res => {
        if (res.ok) {
          // å­˜åœ¨åˆ™åŠ è½½å¤–éƒ¨æ–‡ä»¶
          return fetch('price-map.json').then(r => r.json());
        } else {
          // ä¸å­˜åœ¨åˆ™ç”¨é»˜è®¤
          return null;
        }
      })
      .then(data => {
        if (data) priceMap = data;
        // åŠ¨æ€ç”Ÿæˆå•ç±» datalist é€‰é¡¹
        const danleiDatalist = document.getElementById('danlei-list');
        danleiDatalist.innerHTML = '';
        Object.entries(priceMap).forEach(([key, price]) => {
          const opt = document.createElement('option');
          opt.value = key;
          opt.textContent = `${key} (${price}å…ƒ)`; // æ˜¾ç¤ºä»·æ ¼ä¿¡æ¯
          danleiDatalist.appendChild(opt);
        });
        // è®¾ç½®inputçš„å€¼ä¸ºç¬¬ä¸€ä¸ªkey
        const danleiInput = document.getElementById('danlei');
        if (!danleiInput.value && Object.keys(priceMap).length > 0) {
          danleiInput.value = Object.keys(priceMap)[0];
        }
        updateJine();
      });

    // è®¾ç½®å½“å‰æ—¥æœŸæ—¶é—´
    function pad(n) { return n < 10 ? '0' + n : n; }
    function setCurrentDate() {
      const now = new Date();
      const month = now.getMonth() + 1;
      const day = now.getDate();
      const hour = now.getHours();
      const min = now.getMinutes();
      document.getElementById('riqi').value = `${month}.${day}/${pad(hour)}:${pad(min)}`;
    }
    setCurrentDate();

    // åœºæ§é»˜è®¤å€¼
    function setChangkongDefault() {
      // æ£€æŸ¥ constants.json æ˜¯å¦å­˜åœ¨
      fetch('constants.json', { method: 'HEAD' })
        .then(res => {
          if (res.ok) {
            // å­˜åœ¨åˆ™åŠ è½½
            return fetch('constants.json').then(r => r.json());
          } else {
            // ä¸å­˜åœ¨åˆ™ç”¨é»˜è®¤
            return null;
          }
        })
        .then(data => {
          const changkongList = document.getElementById('changkong-list');
          changkongList.innerHTML = '';
          let changkongArr = ['è½¯è‚‹', 'å°æŸ”'];
          if (data && Array.isArray(data.changkong) && data.changkong.length > 0) {
            changkongArr = data.changkong;
          }
          changkongArr.forEach(name => {
            const opt = document.createElement('option');
            opt.value = name;
            changkongList.appendChild(opt);
          });
          document.getElementById('changkong').value = changkongArr[0];
        });
    }
    setChangkongDefault();

    // è‡ªåŠ¨è®¡ç®—é‡‘é¢
    function updateJine() {
      const danlei = document.getElementById('danlei').value;
      const danshu = parseInt(document.getElementById('danshu').value, 10);
      const price = priceMap[danlei];
      if (typeof price === 'number' && !isNaN(danshu)) {
        document.getElementById('jine').value = price * danshu;
      } else {
        document.getElementById('jine').value = '';
      }
    }
    document.getElementById('danlei').addEventListener('input', updateJine);
    document.getElementById('danshu').addEventListener('input', updateJine);

    // ç”Ÿæˆç¥¨æ®
    function generateTicket() {
      const banbao = document.getElementById('banbao').value.trim();
      const peibao = document.getElementById('peibao').value.trim();
      const danlei = document.getElementById('danlei').value;
      const danshu = document.getElementById('danshu').value;
      const jine = document.getElementById('jine').value;
      const riqi = document.getElementById('riqi').value.trim();
      const changkong = document.getElementById('changkong').value.trim();
      const kouka = document.getElementById('kouka').value.trim();

      const ticket = `â™›ï½¥:.ï½¡.â˜¾ ğ“•ğ“ªğ“²ğ“»ğ”‚ ğ“£ğ“ªğ“µğ“® â˜½.ï½¡.:ï½¥â™›
âœ§ï½¥ï¾Ÿ: âœ§ï½¥ï¾Ÿ: ç»“ å• ç¥¨ :ï¾Ÿï½¥âœ§:ï¾Ÿï½¥âœ§
â‹†ï½¡Ëšê•¥ æ¿ å®ï¼šâ€…â€…${banbao}
â‹†ï½¡Ëšê•¥ é™ª å®ï¼š${peibao}
â‹†ï½¡Ëšê•¥ å• ç±»ï¼š${danlei}
â‹†ï½¡Ëšê•¥ å• æ•°ï¼š${danshu}
â‹†ï½¡Ëšê•¥ é‡‘ é¢ï¼š${jine}
â‹†ï½¡Ëšê•¥ æ—¥ æœŸï¼š${riqi}
â‹†ï½¡Ëšê•¥ åœº æ§ï¼š${changkong}
â‹†ï½¡Ëšê•¥ æ‰£å¡çŠ¶æ€ï¼š${kouka}
âœ§ï½¥ï¾Ÿ: âœ§ï½¥ï¾Ÿ: æ˜Ÿæœˆç«¥è¯ :ï¾Ÿï½¥âœ§:ï¾Ÿï½¥âœ§`;

      document.getElementById('output').value = ticket;
    }

    // å¤åˆ¶ç¥¨æ®
    function copyTicket() {
      const output = document.getElementById('output');
      output.select();
      document.execCommand('copy');
      const btn = document.querySelector('.copy-btn');
      btn.textContent = 'å·²å¤åˆ¶';
      setTimeout(() => {
        btn.textContent = 'å¤åˆ¶';
      }, 2000);
    }
  </script>
</body>

</html>